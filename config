ngx_addon_name=ngx_http_js_module
HTTP_MODULES="$HTTP_MODULES $ngx_addon_name"
HTTP_AUX_FILTER_MODULES="$HTTP_AUX_FILTER_MODULES $ngx_addon_name"

NGX_ADDON_DEPS="$ngx_addon_dir/macroses.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/ngx_http_js_module.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/ngx_http_js_module.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/nginx_js_glue.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/nginx_js_glue.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/strings_util.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/strings_util.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/classes/global.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/classes/global.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/classes/Nginx.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/classes/Nginx.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/classes/Request.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/classes/Request.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/classes/HeadersIn.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/classes/HeadersIn.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/classes/HeadersOut.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/classes/HeadersOut.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/classes/Chain.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/classes/Chain.h"


echo "checking for JavaScript"
NGX_JS_CONFIG="js-config"
NGX_JS_VER=$($NGX_JS_CONFIG --version)
if [[ $NGX_JS_VER == 1.9.* ]]; then
    echo " + SpiderMonkey version: $NGX_JS_VER"
    
    NGX_JS_CONFIG_CFLAGS=$($NGX_JS_CONFIG --cflags)
    CFLAGS="$NGX_JS_CONFIG_CFLAGS $CFLAGS"
    
    NGX_JS_CONFIG_LIBS=$($NGX_JS_CONFIG --libs)
    CORE_LIBS="$CORE_LIBS $NGX_JS_CONFIG_LIBS"
else
    if [[ -z $NGX_JS_VER ]]; then
    	$NGX_JS_VER="(none)"
    fi
    
    echo
    echo "$0: error: SpiderMonkey 1.9.0 or higher is required: $NGX_JS_VER was found"
    echo
    
    exit 1;
fi
