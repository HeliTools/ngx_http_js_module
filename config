ngx_addon_name=ngx_http_js_module

ngx_feature_name=
ngx_feature_run=no

if [ $SPIDERMONKEY ]; then
	SPIDERMONKEY_INC="$SPIDERMONKEY/include/"
	SPIDERMONKEY_LIB="$SPIDERMONKEY/lib/"
fi



# Headers

ngx_found=no

if [ $SPIDERMONKEY_INC ]; then
	ngx_feature_incs="
		#include <js/jsapi.h>
	"
	ngx_feature_test=
	ngx_feature="js/jsapi.h in $SPIDERMONKEY_INC"
	ngx_feature_path="$SPIDERMONKEY_INC"
	ngx_feature_libs=
	. auto/feature
fi

if [ $ngx_found = no ]; then
	ngx_feature_incs="
		#include <js/jsapi.h>
	"
	ngx_feature_test=
	ngx_feature="js/jsapi.h"
	ngx_feature_path=
	ngx_feature_libs=
	. auto/feature
fi

if [ $ngx_found = no ]; then
	echo
	echo $0: error: the $ngx_addon_name addon requires the jsapi headers.
	echo
	
	exit 1
fi

have=NGX_HTTP_JS_HEADERS value="$NGX_HTTP_JS_HEADERS" . auto/define

CORE_INCS="$CORE_INCS $ngx_feature_path"



# Library

ngx_found=no

if [ $SPIDERMONKEY_LIB ]; then
	
	if [ $ngx_found = no ]; then
		ngx_feature_incs=
		ngx_feature_test=
		ngx_feature="libmozjs185.1.0 in $SPIDERMONKEY_LIB"
		ngx_feature_path=
		ngx_feature_libs="-L$SPIDERMONKEY_LIB -lmozjs185.1.0"
		. auto/feature
	fi
	
	if [ $ngx_found = no ]; then
		ngx_feature_incs=
		ngx_feature_test=
		ngx_feature="libmozjs in $SPIDERMONKEY_LIB"
		ngx_feature_path=
		ngx_feature_libs="-L$SPIDERMONKEY_LIB -lmozjs"
		. auto/feature
	fi
	
fi

if [ $ngx_found = no ]; then
	ngx_feature_incs=
	ngx_feature_test=
	ngx_feature="libmozjs185.1.0"
	ngx_feature_path=
	ngx_feature_libs="-lmozjs185.1.0"
	. auto/feature
fi

if [ $ngx_found = no ]; then
	echo
	echo $0: error: the $ngx_addon_name addon requires the js library.
	echo
	
	exit 1
fi

CORE_LIBS="$CORE_LIBS $ngx_feature_libs"



# features

if [ "$HTTP_JS_COLOR" = "yes" ]; then
	have=NGX_HTTP_JS_COLORED . auto/have
fi


ngx_feature_name="NGX_HTTP_JS_SET_STRINGS_ARE_UTF8"
ngx_feature_run=no
ngx_feature_incs=
ngx_feature_test="JS_SetCStringsAreUTF8();"
ngx_feature="JS_SetCStringsAreUTF8()"
ngx_feature_path="$CORE_INCS"
ngx_feature_libs="$CORE_LIBS"
ngx_found=no
. auto/feature


# sources

CFLAGS="-I $ngx_addon_dir/src/ $CFLAGS"


HTTP_MODULES="$HTTP_MODULES $ngx_addon_name"
HTTP_AUX_FILTER_MODULES="$HTTP_AUX_FILTER_MODULES $ngx_addon_name"

NGX_ADDON_DEPS="$ngx_addon_dir/src/nginx_js_macroses.h"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/ngx_http_jsapi.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/ngx_http_js_module.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/ngx_http_js_module.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/nginx_js_glue.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/nginx_js_glue.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/strings_util.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/strings_util.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/global.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/global.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/environment.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/environment.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Nginx.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Nginx.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Request.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Request.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Request/HeadersIn.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Request/HeadersIn.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Request/HeadersIn/Cookies.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Request/HeadersIn/Cookies.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Request/HeadersOut.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Request/HeadersOut.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Request/Variables.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Request/Variables.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Chain.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Chain.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/File.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/File.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS $ngx_addon_dir/src/classes/Dir.c"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $ngx_addon_dir/src/classes/Dir.h"

have=NGX_HTTP_JS_MODULE . auto/have
